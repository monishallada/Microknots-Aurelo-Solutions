<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aurelo Data • Dashboard (Single File)</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --border:#e5e7eb; --muted:#475569; --bg:#fff; --panel:#fafafa; --text:#111;
    }
    *{box-sizing:border-box}
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background: var(--bg); color: var(--text); margin:0; }
    header { background:#fff; border-bottom:1px solid var(--border); padding:12px 20px; display:flex; align-items:center; gap:20px; position:sticky; top:0; z-index:10; }
    nav a { text-decoration:none; color:#111; margin-right:16px; font-weight:600; cursor:pointer; }
    nav a.active { text-decoration:underline; }
    .container { padding:20px; max-width:1200px; margin:auto; }
    h1 { font-size:22px; margin:16px 0; }
    table { width:100%; border-collapse:collapse; margin-top:12px; font-size:14px; }
    th, td { border-bottom:1px solid #f1f5f9; padding:10px; text-align:left; }
    th { text-transform:uppercase; font-size:12px; color:var(--muted); letter-spacing:.06em; }
    .kpis { display:grid; grid-template-columns: repeat(4, 1fr); gap:16px; }
    .kpi { background:var(--panel); padding:16px; border:1px solid var(--border); border-radius:10px; }
    .kpi h2 { margin:0; font-size:13px; color:var(--muted); font-weight:600 }
    .kpi .value { font-size:20px; font-weight:800; margin-top:6px; }
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,select,button{padding:8px 10px;border-radius:8px;border:1px solid var(--border);background:#fff}
    button.btn-primary{background:#111;color:#fff;border-color:#111}
    .right{text-align:right}
    .page { display:none; }
    .page.active { display:block; }
    .muted{color:var(--muted)}
    dialog{border:0;border-radius:12px;padding:0;background:#fff;color:#111;}
    dialog .head{padding:12px 16px;border-bottom:1px solid var(--border);font-weight:700}
    dialog .body{padding:16px}
    dialog .foot{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:8px}
    @media(max-width:1000px){.kpis{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <header>
    <div style="font-weight:800; font-size:18px">Aurelo Data Dashboard</div>
    <nav>
      <a data-page="overview" class="active">Overview</a>
      <a data-page="sales">Sales</a>
      <a data-page="inventory">Inventory</a>
      <a data-page="customers">Customers</a>
      <a data-page="pricing">Pricing</a>
      <a data-page="recommendations">Recommendations</a>
      <a data-page="ops">Operations</a>
      <a data-page="exports">Exports</a>
    </nav>
    <div class="spacer" style="flex:1"></div>
    <div class="controls">
      <select id="region"><option value="all">All Regions</option><option>East</option><option>Central</option><option>West</option></select>
      <select id="channel"><option value="all">All Channels</option><option>In-Store</option><option>Online</option><option>Wholesale</option></select>
      <input type="date" id="from" />
      <input type="date" id="to" />
      <button class="btn-primary" id="apply">Apply</button>
    </div>
  </header>

  <div class="container">
    <!-- OVERVIEW -->
    <section id="overview" class="page active">
      <h1>Overview</h1>
      <div class="kpis">
        <div class="kpi"><h2>Revenue (MTD)</h2><div class="value" id="kpiRev">$1,204,560</div></div>
        <div class="kpi"><h2>Units Sold</h2><div class="value" id="kpiUnits">48,920</div></div>
        <div class="kpi"><h2>Avg Order Value</h2><div class="value" id="kpiAov">$43.12</div></div>
        <div class="kpi"><h2>Gross Margin</h2><div class="value" id="kpiGm">38.6%</div></div>
      </div>
      <canvas id="revTrend" height="110"></canvas>

      <h1>Top Products</h1>
      <div class="controls" style="margin-bottom:8px"><input id="prodSearch" placeholder="Search products or SKUs" /><button id="exportTop">Export CSV</button></div>
      <table id="topProducts">
        <thead><tr><th>Product</th><th>SKU</th><th>Category</th><th class="right">Revenue</th><th class="right">Units</th><th class="right">Margin</th></tr></thead>
        <tbody></tbody>
      </table>

      <h1>Store Performance</h1>
      <div class="controls"><button id="rankRevenue">Rank by Revenue</button><button id="rankNps">Rank by NPS</button></div>
      <table id="storePerf">
        <thead><tr><th>Store</th><th>Region</th><th class="right">Revenue</th><th class="right">YoY</th><th class="right">NPS</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- SALES -->
    <section id="sales" class="page">
      <h1>Sales</h1>
      <h2 class="muted" style="font-size:14px;margin:0 0 8px 0">Channel Mix</h2>
      <canvas id="channelPie" height="120"></canvas>
      <h2 class="muted" style="font-size:14px;margin:18px 0 8px 0">Hourly Traffic</h2>
      <canvas id="heat" height="110"></canvas>
    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="page">
      <h1>Inventory</h1>
      <div class="controls" style="margin-bottom:10px"><button class="btn-primary" id="reorder">Create Reorder PO</button></div>
      <table id="lowStock">
        <thead><tr><th>Product</th><th>SKU</th><th class="right">On Hand</th><th class="right">Days Cover</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- CUSTOMERS -->
    <section id="customers" class="page">
      <h1>Customers</h1>
      <h2 class="muted" style="font-size:14px;margin:0 0 8px 0">Customer Segments</h2>
      <canvas id="seg" height="110"></canvas>
      <h2 style="font-size:16px;margin:18px 0 8px 0">Cohort Retention (90-day)</h2>
      <table id="cohorts">
        <thead><tr><th>Cohort</th><th class="right">Week 1</th><th class="right">Week 4</th><th class="right">Week 8</th><th class="right">Week 12</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- PRICING -->
    <section id="pricing" class="page">
      <h1>Pricing</h1>
      <div class="controls" style="margin-bottom:10px"><button class="btn-primary" id="sync">Sync Competitor Prices</button></div>
      <table id="comp">
        <thead><tr><th>Product</th><th>Our Price</th><th>Competitor</th><th>Competitor Price</th><th class="right">Delta</th></tr></thead>
        <tbody></tbody>
      </table>

      <h2 style="font-size:16px;margin:18px 0 8px 0">Elasticity Sandbox</h2>
      <div class="controls" style="margin-bottom:10px">
        <label>Price ($): <input id="p" type="number" value="20" step="0.5" style="width:120px"></label>
        <label>Elasticity (E): <input id="e" type="number" value="-1.4" step="0.1" style="width:120px"></label>
        <button id="run">Run</button>
      </div>
      <div id="out" class="muted" style="font-size:14px">Expected demand change: —</div>
    </section>

    <!-- RECOMMENDATIONS -->
    <section id="recommendations" class="page">
      <h1>Recommendations</h1>
      <h2 style="font-size:16px;margin:0 0 8px 0">Bundle Recommendations</h2>
      <table id="bundles">
        <thead><tr><th>Bundle</th><th>Lift</th><th>Support</th><th class="right">Est. Uplift</th></tr></thead>
        <tbody></tbody>
      </table>
      <h2 style="font-size:16px;margin:18px 0 8px 0">Promo Calendar</h2>
      <table id="promos">
        <thead><tr><th>Date</th><th>Campaign</th><th>Channel</th><th class="right">Target Uplift</th></tr></thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- OPS -->
    <section id="ops" class="page">
      <h1>Operations</h1>
      <h2 class="muted" style="font-size:14px;margin:0 0 8px 0">Live Alerts</h2>
      <table id="alerts">
        <thead><tr><th>Time</th><th>Type</th><th>Message</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
      <h2 style="font-size:16px;margin:18px 0 8px 0">Ops Checklist</h2>
      <ul style="line-height:1.9; padding-left:18px">
        <li><label><input type="checkbox"/> Reconcile previous day sales</label></li>
        <li><label><input type="checkbox"/> Verify deposits & chargebacks</label></li>
        <li><label><input type="checkbox"/> Review low stock SKUs</label></li>
        <li><label><input type="checkbox"/> Update promo signage</label></li>
      </ul>
    </section>

    <!-- EXPORTS -->
    <section id="exports" class="page">
      <h1>Exports</h1>
      <div class="controls" style="margin-bottom:12px">
        <select id="what">
          <option value="top">Top Products</option>
          <option value="stores">Store Performance</option>
          <option value="low">Low Stock</option>
          <option value="comp">Competitor Pricing</option>
          <option value="alerts">Alerts</option>
        </select>
        <button class="btn-primary" id="export">Export CSV</button>
      </div>
      <div id="preview"></div>
    </section>
  </div>

  <!-- Modal for Inventory -->
  <dialog id="modal">
    <div class="head">Reorder Purchase Order</div>
    <div class="body" id="modalBody"></div>
    <div class="foot"><button id="modalClose">Close</button></div>
  </dialog>

  <script>
    // ======== DATA (realistic demo) ========
    const catalog=[
      {name:'Aurelo Energy Drink — Citrus 12oz',sku:'AE-C12',cat:'Beverage',margin:0.41,revenue:182340,units:8120},
      {name:'Aurelo Energy Drink — Berry 12oz',sku:'AE-B12',cat:'Beverage',margin:0.40,revenue:132420,units:7011},
      {name:'Aurelo Protein Bar — Cocoa 6pk',sku:'AP-B06',cat:'Snacks',margin:0.36,revenue:143220,units:10112},
      {name:'Aurelo Protein Bar — Peanut 6pk',sku:'AP-P06',cat:'Snacks',margin:0.35,revenue:111560,units:7840},
      {name:'Aurelo Sparkling Water — Lime 8pk',sku:'AS-L08',cat:'Beverage',margin:0.33,revenue:122110,units:9033},
      {name:'Aurelo Smart Bottle 24oz',sku:'AB-24',cat:'Accessories',margin:0.48,revenue:117890,units:2890},
      {name:'Aurelo Electrolyte Mix — Berry 20ct',sku:'AM-B20',cat:'Supplements',margin:0.39,revenue:98310,units:4520},
      {name:'Aurelo Creatine 300g',sku:'AC-300',cat:'Supplements',margin:0.45,revenue:79230,units:2100}
    ];
    const storePerf=[
      {store:'Raleigh 01',region:'East',revenue:264500,yoy:8.4,nps:72},
      {store:'Charlotte 02',region:'East',revenue:241200,yoy:6.2,nps:69},
      {store:'Austin 07',region:'Central',revenue:223400,yoy:9.1,nps:75},
      {store:'San Jose 03',region:'West',revenue:215600,yoy:5.6,nps:71},
      {store:'Seattle 05',region:'West',revenue:198400,yoy:6.8,nps:73},
      {store:'Chicago 04',region:'Central',revenue:187900,yoy:4.9,nps:68}
    ];
    const catSales={'Beverage':520000,'Snacks':430000,'Accessories':280000,'Supplements':390000};
    const channelMix={"In-Store":582000,"Online":341000,"Wholesale":78000};
    const heatHours=['9a','10a','11a','12p','1p','2p','3p','4p','5p'];
    const heatTraffic=[120,160,220,340,360,300,240,210,170];
    const lowStock=[{name:'Smart Bottle 24oz',sku:'AB-24',on:28,days:3,status:'Critical'},{name:'Protein Bar — Cocoa 6pk',sku:'AP-B06',on:140,days:5,status:'Low'},{name:'Electrolyte Mix — Berry 20ct',sku:'AM-B20',on:80,days:4,status:'Low'}];
    const competitors=[{name:'Smart Bottle 24oz', ours:29.99, comp:'HydraCo', compPrice:31.49},{name:'Protein Bar — Cocoa 6pk', ours:9.99, comp:'Snacky', compPrice:8.49},{name:'Energy Drink — Citrus 12oz', ours:2.49, comp:'VoltUp', compPrice:2.79},{name:'Sparkling Water — Lime 8pk', ours:5.49, comp:'Fizz+Lime', compPrice:5.19}];
    const bundles=[{bundle:'Energy Drink + Protein Bar', lift:1.22, support:0.18, uplift: 42000},{bundle:'Smart Bottle + Electrolyte Mix', lift:1.17, support:0.11, uplift: 23000},{bundle:'Creatine + Smart Bottle', lift:1.09, support:0.07, uplift: 9000}];
    const promos=[{date:'2025-09-25', campaign:'End-of-Quarter Boost', channel:'Omni', uplift:'+9%'},{date:'2025-10-01', campaign:'Fall Fuel Week', channel:'Omni', uplift:'+12%'}];
    const alerts=[{time:'09:14', type:'Stock', msg:'AB-24 below 30 units at Raleigh 01', status:'Open'},{time:'10:02', type:'POS', msg:'Gateway retry at San Jose 03 (resolved)', status:'Resolved'},{time:'11:35', type:'Chargeback', msg:'Dispute opened for order #81342', status:'Open'}];

    // ======== HELPERS ========
    const money=v=>new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'}).format(v);
    const int=v=>new Intl.NumberFormat().format(v);
    function toCSV(rows){return rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('
')}
    function downloadCSV(filename, rows){const csv=toCSV(rows);const url=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));const a=Object.assign(document.createElement('a'),{href:url,download:filename});document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)}

    // ======== NAVIGATION ========
    document.querySelectorAll('nav a').forEach(link=>{
      link.addEventListener('click',()=>{
        document.querySelectorAll('nav a').forEach(l=>l.classList.remove('active'));
        link.classList.add('active');
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.getElementById(link.dataset.page).classList.add('active');
        // lazy-render charts on first visit
        if(link.dataset.page==='sales' && !window.__salesRendered) renderSales();
        if(link.dataset.page==='customers' && !window.__custRendered) renderCustomers();
      });
    });

    // ======== OVERVIEW RENDER ========
    function renderOverview(){
      // trend chart (static weekly series)
      const ctx=document.getElementById('revTrend');
      new Chart(ctx,{type:'line',data:{labels:['W1','W2','W3','W4','W5','W6','W7','W8','W9','W10','W11','W12'],datasets:[{label:'Revenue',data:[42000,45000,48000,52000,55000,58000,62000,61000,66000,70000,74000,78000],borderColor:'#111',backgroundColor:'rgba(17,17,17,.08)',fill:true,tension:.35}]},options:{plugins:{legend:{display:false}},scales:{y:{grid:{color:'#eee'}},x:{grid:{display:false}}}}});

      // top products
      function drawTop(list){const tb=document.querySelector('#topProducts tbody');tb.innerHTML='';list.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r.name}</td><td>${r.sku}</td><td>${r.cat}</td><td class='right'>${money(r.revenue)}</td><td class='right'>${int(r.units)}</td><td class='right'>${(r.margin*100).toFixed(1)}%</td>`;tb.appendChild(tr);});}
      drawTop(catalog.sort((a,b)=>b.revenue-a.revenue).slice(0,6));
      document.getElementById('prodSearch').addEventListener('input',e=>{const q=e.target.value.toLowerCase();drawTop(catalog.filter(p=>p.name.toLowerCase().includes(q)||p.sku.toLowerCase().includes(q)));});
      document.getElementById('exportTop').addEventListener('click',()=>{
        const rows=[["Product","SKU","Category","Revenue","Units","Margin"],...Array.from(document.querySelectorAll('#topProducts tbody tr')).map(tr=>Array.from(tr.children).map(td=>td.textContent))];
        downloadCSV('top_products.csv',rows);
      });

      // store performance
      function drawStores(list){const tb=document.querySelector('#storePerf tbody');tb.innerHTML='';list.forEach(s=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${s.store}</td><td>${s.region}</td><td class='right'>${money(s.revenue)}</td><td class='right'>${s.yoy>0?'+':''}${s.yoy.toFixed(1)}%</td><td class='right'>${s.nps}</td>`;tb.appendChild(tr);});}
      drawStores(storePerf);
      document.getElementById('rankRevenue').addEventListener('click',()=>drawStores([...storePerf].sort((a,b)=>b.revenue-a.revenue)));
      document.getElementById('rankNps').addEventListener('click',()=>drawStores([...storePerf].sort((a,b)=>b.nps-a.nps)));
    }

    // ======== SALES RENDER ========
    function renderSales(){
      // channel pie
      const ctx1=document.getElementById('channelPie');
      new Chart(ctx1,{type:'doughnut',data:{labels:Object.keys(channelMix),datasets:[{data:Object.values(channelMix)}]},options:{plugins:{legend:{position:'bottom'}}}});
      // hourly bar
      const ctx2=document.getElementById('heat');
      new Chart(ctx2,{type:'bar',data:{labels:heatHours,datasets:[{label:'Transactions',data:heatTraffic}]},options:{plugins:{legend:{display:false}},scales:{y:{grid:{color:'#eee'}},x:{grid:{display:false}}}}});
      window.__salesRendered=true;
    }

    // ======== INVENTORY RENDER ========
    function renderInventory(){
      const tb=document.querySelector('#lowStock tbody');tb.innerHTML='';
      lowStock.forEach(s=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${s.name}</td><td>${s.sku}</td><td class='right'>${s.on}</td><td class='right'>${s.days}</td><td>${s.status}</td>`;tb.appendChild(tr);});
      document.getElementById('reorder').addEventListener('click',()=>{
        const html=`<table style='width:100%;border-collapse:collapse'>
          <thead><tr><th style='text-align:left;padding:6px;border-bottom:1px solid #eee'>Product</th><th style='text-align:left;padding:6px;border-bottom:1px solid #eee'>SKU</th><th style='text-align:right;padding:6px;border-bottom:1px solid #eee'>On Hand</th></tr></thead>
          <tbody>${lowStock.map(x=>`<tr><td style='padding:6px;border-bottom:1px solid #f1f5f9'>${x.name}</td><td style='padding:6px;border-bottom:1px solid #f1f5f9'>${x.sku}</td><td style='padding:6px;text-align:right;border-bottom:1px solid #f1f5f9'>${x.on}</td></tr>`).join('')}</tbody>
        </table>
        <div style='margin-top:10px;display:flex;gap:8px;align-items:center'>
          <button id='submitPO' style='padding:8px 10px;border-radius:8px;border:1px solid #111;background:#111;color:#fff'>Submit PO</button>
        </div>`;
        document.getElementById('modalBody').innerHTML=html;
        document.getElementById('modal').showModal();
        document.getElementById('submitPO').addEventListener('click',()=>{document.getElementById('modal').close();alert('PO submitted (demo)');});
      });
    }

    // ======== CUSTOMERS RENDER ========
    function renderCustomers(){
      const ctx=document.getElementById('seg');
      new Chart(ctx,{type:'doughnut',data:{labels:['Loyal','Occasional','New'],datasets:[{data:[44,38,18]}]},options:{plugins:{legend:{position:'bottom'}}}});
      const rows=[
        ['Jul‑2025','32%','21%','16%','12%'],
        ['Aug‑2025','34%','22%','17%','13%'],
        ['Sep‑2025','33%','23%','18%','—']
      ];
      const tb=document.querySelector('#cohorts tbody');tb.innerHTML='';
      rows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r[0]}</td><td class='right'>${r[1]}</td><td class='right'>${r[2]}</td><td class='right'>${r[3]}</td><td class='right'>${r[4]}</td>`;tb.appendChild(tr);});
      window.__custRendered=true;
    }

    // ======== PRICING RENDER ========
    function renderPricing(){
      const tb=document.querySelector('#comp tbody');tb.innerHTML='';
      competitors.forEach(r=>{const d=(r.ours-r.compPrice).toFixed(2);const cls=parseFloat(d)<=0?'color:green':'color:#b91c1c';const tr=document.createElement('tr');tr.innerHTML=`<td>${r.name}</td><td>${money(r.ours)}</td><td>${r.comp}</td><td>${money(r.compPrice)}</td><td class='right' style='${cls}'>${parseFloat(d)>0?'+':''}${d}</td>`;tb.appendChild(tr);});
      document.getElementById('sync').addEventListener('click',()=>{renderPricing();alert('Competitor prices refreshed (demo)');});
      document.getElementById('run').addEventListener('click',()=>{const p=parseFloat(document.getElementById('p').value);const E=parseFloat(document.getElementById('e').value);const pct=E*1;document.getElementById('out').textContent=`Expected demand change for $1 price change at $${p.toFixed(2)} with E=${E.toFixed(1)} → ${pct.toFixed(1)}%`;});
    }

    // ======== RECOMMENDATIONS RENDER ========
    function renderRecommendations(){
      const tb1=document.querySelector('#bundles tbody');tb1.innerHTML='';
      bundles.forEach(b=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${b.bundle}</td><td>${b.lift.toFixed(2)}×</td><td>${(b.support*100).toFixed(1)}%</td><td class='right'>${money(b.uplift)}</td>`;tb1.appendChild(tr);});
      const tb2=document.querySelector('#promos tbody');tb2.innerHTML='';
      promos.forEach(p=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${p.date}</td><td>${p.campaign}</td><td>${p.channel}</td><td class='right'>${p.uplift}</td>`;tb2.appendChild(tr);});
    }

    // ======== OPS RENDER ========
    function renderOps(){
      const tb=document.querySelector('#alerts tbody');tb.innerHTML='';
      alerts.forEach(a=>{const cls=a.status==='Open'?'color:#b91c1c':'color:green';const tr=document.createElement('tr');tr.innerHTML=`<td>${a.time}</td><td>${a.type}</td><td>${a.msg}</td><td style='${cls}'>${a.status}</td>`;tb.appendChild(tr);});
    }

    // ======== EXPORTS RENDER ========
    function renderExports(){
      const preview=document.getElementById('preview');
      function table(rows){const table=document.createElement('table');const thead=document.createElement('thead');const trh=document.createElement('tr');rows[0].forEach(h=>{const th=document.createElement('th');th.textContent=h;trh.appendChild(th)});thead.appendChild(trh);table.appendChild(thead);const tb=document.createElement('tbody');rows.slice(1).forEach(r=>{const tr=document.createElement('tr');r.forEach(c=>{const td=document.createElement('td');td.textContent=c;tr.appendChild(td)});tb.appendChild(tr)});table.appendChild(tb);return table}
      function getRows(){
        const top=[["Product","SKU","Revenue","Units","Margin"],...catalog.slice(0,4).map(p=>[p.name,p.sku,money(p.revenue),int(p.units),(p.margin*100).toFixed(0)+"%"])]
        const stores=[["Store","Region","Revenue","YoY","NPS"],...storePerf.map(s=>[s.store,s.region,money(s.revenue),(s.yoy>0?"+":"")+s.yoy+"%",String(s.nps)])]
        const low=[["Product","SKU","On Hand","Days Cover","Status"],...lowStock.map(x=>[x.name,x.sku,String(x.on),String(x.days),x.status])]
        const comp=[["Product","Our Price","Competitor","Competitor Price","Delta"],...competitors.map(r=>[r.name,money(r.ours),r.comp,money(r.compPrice),(r.ours-r.compPrice).toFixed(2)])]
        const al=[["Time","Type","Message","Status"],...alerts.map(a=>[a.time,a.type,a.msg,a.status])]
        const v=document.getElementById('what').value;return v==='top'?top:v==='stores'?stores:v==='low'?low:v==='comp'?comp:al
      }
      function draw(){preview.innerHTML='';preview.appendChild(table(getRows()))}
      draw();
      document.getElementById('what').addEventListener('change',draw);
      document.getElementById('export').addEventListener('click',()=>downloadCSV(`${document.getElementById('what').value}.csv`,getRows()));
    }

    // ======== FILTERS (demo math) ========
    function applyFilters(){
      const region=document.getElementById('region').value; const channel=document.getElementById('channel').value;
      let factor=1; if(region==='East')factor=1.04; if(region==='West')factor=0.98; if(region==='Central')factor=1.01;
      if(channel==='Online')factor*=0.92; if(channel==='In-Store')factor*=1.06; if(channel==='Wholesale')factor*=0.75;
      const baseRev=1204560*factor; const units=48920*factor; const aov=43.12*(1+(Math.random()-.5)/20);
      document.getElementById('kpiRev').textContent=money(baseRev);
      document.getElementById('kpiUnits').textContent=int(Math.round(units));
      document.getElementById('kpiAov').textContent=money(aov);
      document.getElementById('kpiGm').textContent=(38.6+(Math.random()-.5)).toFixed(1)+'%';
    }

    // ======== INIT ========
    (function init(){
      // default date range last 30 days
      const today=new Date(); const from=new Date(today); from.setDate(today.getDate()-29);
      document.getElementById('to').value=today.toISOString().slice(0,10);
      document.getElementById('from').value=from.toISOString().slice(0,10);

      // initial renders
      renderOverview();
      renderInventory();
      renderPricing();
      renderRecommendations();
      renderOps();
      renderExports();

      // events
      document.getElementById('apply').addEventListener('click',applyFilters);
      document.getElementById('modalClose').addEventListener('click',()=>document.getElementById('modal').close());
    })();
  </script>
</body>
</html>
