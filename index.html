<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aurelo Data â€” Store Intelligence Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0b0d12; --panel:#121621; --panel-2:#0e1220; --text:#e6e9ef; --muted:#9aa3b2; --brand:#7b5cff; --accent:#23c9b5;
      --card:#131827; --border:#1b2236; --shadow:0 10px 30px rgba(0,0,0,.35);
      --good:#17c964; --warn:#f5a524; --bad:#f31260;
    }
    [data-theme="light"]{
      --bg:#f7f8fb; --panel:#ffffff; --panel-2:#f3f5fa; --text:#111827; --muted:#596273; --brand:#5a46ff; --accent:#0bbf9a;
      --card:#ffffff; --border:#e8ecf3; --shadow:0 8px 24px rgba(0,0,0,.08);
      --good:#16a34a; --warn:#d97706; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:linear-gradient(180deg,var(--bg),var(--panel-2) 200%);
      color:var(--text);
    }
    /* Layout */
    .app{display:grid; grid-template-columns:280px 1fr; min-height:100dvh}
    .sidebar{
      background:linear-gradient(180deg,var(--panel),var(--panel-2));
      border-right:1px solid var(--border);
      padding:22px 18px; position:sticky; top:0; height:100dvh; overflow:auto;
    }
    .brand{
      display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px; margin-bottom:18px;
    }
    .logo{
      width:34px; height:34px; border-radius:10px; background:
        radial-gradient(100% 100% at 0% 0%, var(--brand), transparent 60%),
        radial-gradient(120% 120% at 100% 100%, var(--accent), transparent 60%),
        linear-gradient(140deg, rgba(255,255,255,.08), rgba(255,255,255,0));
      box-shadow:var(--shadow);
    }
    .sidebar .muted{color:var(--muted); font-size:12px; text-transform:uppercase; letter-spacing:.12em; margin:18px 0 8px}
    .nav{display:flex; flex-direction:column; gap:8px}
    .nav button{
      width:100%; text-align:left; padding:10px 12px; background:transparent; border:1px solid transparent; color:var(--text);
      border-radius:10px; cursor:pointer; font-weight:500; transition:.18s ease; display:flex; align-items:center; gap:10px;
    }
    .nav button:hover{background:var(--card); border-color:var(--border)}
    .nav button.active{background:linear-gradient(180deg,var(--card),transparent); border-color:var(--brand); box-shadow:inset 0 0 0 1px rgba(123,92,255,.25)}
    .pill{
      background:rgba(123,92,255,.16); color:var(--brand); border:1px solid rgba(123,92,255,.35);
      padding:2px 8px; border-radius:999px; font-size:11px; margin-left:auto;
    }
    .collapse{
      display:inline-flex; align-items:center; gap:8px; margin-top:14px; font-size:12px; color:var(--muted); cursor:pointer; user-select:none;
    }
    .main{padding:22px 22px 32px}
    .topbar{
      display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:space-between; margin-bottom:14px;
    }
    .filters{display:flex; gap:10px; flex-wrap:wrap}
    .input, .select{
      background:var(--card); border:1px solid var(--border); color:var(--text);
      padding:8px 10px; border-radius:10px; outline:none; min-height:38px;
    }
    .btn{
      background:var(--brand); color:#fff; border:1px solid rgba(255,255,255,.06);
      padding:9px 12px; border-radius:12px; cursor:pointer; font-weight:600; box-shadow:var(--shadow);
    }
    .btn.secondary{background:var(--accent)}
    .btn.ghost{background:transparent; color:var(--text); border:1px solid var(--border)}
    .dash{
      display:grid; gap:14px; grid-template-columns:repeat(12,1fr);
    }
    .card{
      background:linear-gradient(180deg,var(--card), transparent 220%);
      border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:var(--shadow);
    }
    .kpis{grid-column:1/-1; display:grid; gap:12px; grid-template-columns:repeat(4,1fr)}
    .kpi{display:grid; gap:6px}
    .kpi .title{color:var(--muted); font-size:12px; letter-spacing:.06em; text-transform:uppercase}
    .kpi .value{font-size:28px; font-weight:700}
    .kpi .delta{font-size:12px}
    .delta.good{color:var(--good)} .delta.warn{color:var(--warn)} .delta.bad{color:var(--bad)}
    .grid-6{grid-column:span 6}
    .grid-4{grid-column:span 4}
    .grid-8{grid-column:span 8}
    .grid-12{grid-column:1/-1}
    .section-title{display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
    .table{width:100%; border-collapse:separate; border-spacing:0 8px}
    .table th{font-size:12px; color:var(--muted); text-align:left; padding:8px 10px}
    .table td{padding:12px 10px; background:var(--panel); border-top:1px solid var(--border); border-bottom:1px solid var(--border)}
    .table tr td:first-child{border-left:1px solid var(--border); border-top-left-radius:10px; border-bottom-left-radius:10px}
    .table tr td:last-child{border-right:1px solid var(--border); border-top-right-radius:10px; border-bottom-right-radius:10px}
    .badge{font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted)}
    .flex{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .grow{flex:1}
    .right{margin-left:auto}
    .hidden{display:none!important}
    .footer{color:var(--muted); font-size:12px; text-align:center; margin-top:14px}
    /* responsive */
    @media (max-width:1100px){ .grid-6,.grid-8{grid-column:1/-1} .kpis{grid-template-columns:repeat(2,1fr)} .app{grid-template-columns:70px 1fr} .sidebar .text{display:none} .brand span{display:none} }
    @media (max-width:720px){ .kpis{grid-template-columns:1fr} .topbar{flex-direction:column; align-items:stretch} .filters{width:100%} .filters>*{flex:1} }
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <span>Aurelo Data</span>
      </div>
      <div class="muted">Navigation</div>
      <div class="nav">
        <button class="active" data-section="overview">Overview <span class="pill">Live</span></button>
        <button data-section="products">Products</button>
        <button data-section="pricing">Pricing Intel</button>
        <button data-section="inventory">Inventory</button>
        <button data-section="customers">Customers</button>
        <button data-section="ops">Operations</button>
        <button data-section="settings">Settings</button>
      </div>
      <div class="collapse" id="collapseBtn">âŸ¨âŸ¨ Collapse</div>
      <div style="margin-top:16px; padding:12px; background:var(--panel); border:1px solid var(--border); border-radius:12px">
        <div style="font-weight:600; margin-bottom:6px">Todayâ€™s Highlights</div>
        <div class="flex" style="font-size:13px; color:var(--muted)">
          <div>â€¢ 3 low-stock alerts</div>
          <div>â€¢ 1 competitor undercut</div>
          <div>â€¢ +5.2% basket size</div>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="flex grow">
          <div class="input" style="display:flex; gap:8px; align-items:center">
            ðŸ”Ž <input id="searchInput" placeholder="Search products, SKUs, categoriesâ€¦" style="border:0; outline:0; background:transparent; color:var(--text); width:260px">
          </div>
          <select id="storeSelect" class="select">
            <option value="all">All Stores</option>
            <option>Raleigh #101</option>
            <option>Apex #204</option>
            <option>Cary #325</option>
            <option>Durham #412</option>
          </select>
          <input type="date" id="fromDate" class="input">
          <input type="date" id="toDate" class="input">
          <button class="btn" id="applyFilters">Apply</button>
        </div>
        <div class="flex">
          <button class="btn ghost" id="toggleTheme" title="Toggle theme">ðŸŒ—</button>
          <button class="btn secondary" id="exportCSV">Export CSV</button>
        </div>
      </div>

      <!-- KPI Cards -->
      <section class="dash">
        <div class="card kpis">
          <div class="kpi">
            <div class="title">Revenue (Today)</div>
            <div class="value" id="kpiRevenue">$128,430</div>
            <div class="delta good" id="kpiRevenueDelta">â–² 6.4% vs. last week</div>
          </div>
          <div class="kpi">
            <div class="title">Units Sold</div>
            <div class="value" id="kpiUnits">23,987</div>
            <div class="delta good" id="kpiUnitsDelta">â–² 3.1%</div>
          </div>
          <div class="kpi">
            <div class="title">Avg Basket</div>
            <div class="value" id="kpiBasket">$42.78</div>
            <div class="delta warn" id="kpiBasketDelta">â–² 1.2% price influence</div>
          </div>
          <div class="kpi">
            <div class="title">OOS Risk</div>
            <div class="value" id="kpiOOS">14 SKUs</div>
            <div class="delta bad">â–¼ Reorder now</div>
          </div>
        </div>

        <!-- Revenue Trend -->
        <div class="card grid-8">
          <div class="section-title">
            <div><strong>Revenue Trend</strong> <span class="badge">Last 8 weeks</span></div>
            <div class="flex">
              <button class="btn ghost" data-series="revenue">Revenue</button>
              <button class="btn ghost" data-series="units">Units</button>
              <button class="btn ghost" data-series="basket">Basket</button>
            </div>
          </div>
          <canvas id="revChart" height="120"></canvas>
        </div>

        <!-- Category Mix -->
        <div class="card grid-4">
          <div class="section-title">
            <div><strong>Category Mix</strong></div>
            <div class="badge">Share</div>
          </div>
          <canvas id="mixChart" height="120"></canvas>
          <div class="flex" style="margin-top:10px; justify-content:space-between; font-size:13px; color:var(--muted)">
            <div>Grocery <strong id="mixGro">â€”</strong></div>
            <div>Dairy <strong id="mixDai">â€”</strong></div>
            <div>Produce <strong id="mixPro">â€”</strong></div>
          </div>
        </div>

        <!-- Top Products -->
        <div class="card grid-6">
          <div class="section-title">
            <div><strong>Top Products</strong> <span class="badge">Revenue</span></div>
            <div class="flex">
              <div class="input"><input id="topSearch" placeholder="Filterâ€¦" style="border:0; outline:0; background:transparent; color:var(--text)"></div>
              <button class="btn ghost" id="sortRevenue">Sort by $</button>
              <button class="btn ghost" id="sortUnits">Sort by Units</button>
            </div>
          </div>
          <table class="table" id="topTable">
            <thead>
              <tr><th>SKU</th><th>Name</th><th>Category</th><th>Units</th><th>Price</th><th>Revenue</th><th></th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Competitor Pricing -->
        <div class="card grid-6">
          <div class="section-title">
            <div><strong>Competitor Pricing</strong> <span class="badge">Undercuts</span></div>
            <div class="flex">
              <button class="btn ghost" id="matchAll">Match Best Price</button>
              <button class="btn ghost" id="reprice10">Smart Reprice âˆ’10%</button>
            </div>
          </div>
          <table class="table" id="priceTable">
            <thead>
              <tr><th>Product</th><th>Us</th><th>Competitor</th><th>Delta</th><th>Status</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Recommendations -->
        <div class="card grid-8">
          <div class="section-title">
            <div><strong>Recommendations</strong></div>
            <div class="flex">
              <span class="badge">Promo</span><span class="badge">Replenish</span><span class="badge">Reprice</span>
            </div>
          </div>
          <div id="recs" class="flex" style="gap:12px; flex-wrap:wrap"></div>
        </div>

        <!-- Inventory Health -->
        <div class="card grid-4">
          <div class="section-title">
            <div><strong>Inventory Health</strong></div>
            <div class="badge">Days of Supply</div>
          </div>
          <canvas id="invChart" height="120"></canvas>
          <div style="font-size:13px; color:var(--muted); margin-top:8px">Target DoS: 21 days</div>
        </div>

        <!-- Customer Cohorts -->
        <div class="card grid-12">
          <div class="section-title">
            <div><strong>Customer Retention</strong> <span class="badge">Cohorts</span></div>
          </div>
          <canvas id="cohortChart" height="80"></canvas>
        </div>

        <!-- Footer -->
        <div class="grid-12 footer">Â© <span id="year"></span> Aurelo Data â€¢ Store Intelligence â€¢ v1.0</div>
      </section>

      <!-- Sections placeholders (switch via sidebar) -->
      <section id="section-products" class="card grid-12 hidden">Products section coming alive with search & bulk edits.</section>
      <section id="section-pricing" class="card grid-12 hidden">Pricing intelligence tools, elasticity sandbox, promo simulator.</section>
      <section id="section-inventory" class="card grid-12 hidden">Inventory workbench, reorder planner, lead-time tracker.</section>
      <section id="section-customers" class="card grid-12 hidden">Customer segments, RFM, LTV projections, churn radar.</section>
      <section id="section-ops" class="card grid-12 hidden">Operations KPIs, labor utilization, shrink, SLA monitors.</section>
      <section id="section-settings" class="card grid-12 hidden">Brand, users, API keys, data feeds, exports.</section>
    </main>
  </div>

  <!-- Modal -->
  <div id="modal" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; padding:16px">
    <div style="background:var(--panel); border:1px solid var(--border); border-radius:14px; width:min(680px,95vw); padding:16px; box-shadow:var(--shadow)">
      <div class="section-title"><strong id="modalTitle">Product</strong><button class="btn ghost" id="closeModal">Close</button></div>
      <div id="modalBody" style="color:var(--muted); line-height:1.6"></div>
    </div>
  </div>

  <script>
    // ---------- Utilities ----------
    const $ = (sel, el=document)=>el.querySelector(sel);
    const $$ = (sel, el=document)=>Array.from(el.querySelectorAll(sel));
    const fmt = new Intl.NumberFormat(undefined,{maximumFractionDigits:0});
    const fmt2 = new Intl.NumberFormat(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
    const money = v=>"$"+fmt2.format(v);
    const clamp = (v,min,max)=>Math.max(min,Math.min(max,v));
    const rand = (min,max)=>Math.random()*(max-min)+min;
    const pick = arr => arr[Math.floor(Math.random()*arr.length)];

    // ---------- Theme ----------
    const themeBtn = $('#toggleTheme');
    themeBtn.addEventListener('click', ()=>{
      const next = document.body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', next);
      revChart.update(); mixChart.update(); invChart.update(); cohortChart.update();
    });

    // ---------- Sidebar collapse ----------
    const side = $('#sidebar'); const collapseBtn = $('#collapseBtn');
    collapseBtn.onclick = ()=>{
      const narrow = getComputedStyle(document.querySelector('.app')).gridTemplateColumns.startsWith('70px');
      document.querySelector('.app').style.gridTemplateColumns = narrow ? '280px 1fr' : '70px 1fr';
      collapseBtn.textContent = narrow ? 'âŸ¨âŸ¨ Collapse' : 'âŸ©âŸ© Expand';
    };

    // ---------- Navigation show/hide sections ----------
    $$('.nav button').forEach(btn=>{
      btn.onclick = ()=>{
        $$('.nav button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const target = btn.dataset.section;
        // Hide extra sections
        ['products','pricing','inventory','customers','ops','settings'].forEach(id=>{
          const el = document.getElementById('section-'+id);
          if(el) el.classList.add('hidden');
        });
        if(target !== 'overview'){
          document.querySelector('.dash').classList.add('hidden');
          const el = document.getElementById('section-'+target);
          if(el) el.classList.remove('hidden');
        } else {
          document.querySelector('.dash').classList.remove('hidden');
        }
      };
    });

    // ---------- Sample Data ----------
    const categories = ['Grocery','Dairy','Produce','Bakery','Beverage','Frozen','Household'];
    const products = Array.from({length:60},(_,i)=>{
      const cat = pick(categories);
      const price = +(rand(1.2,24.9).toFixed(2));
      const units = Math.floor(rand(120,4000));
      return {
        sku:'SKU'+(10000+i),
        name: cat+' Item '+(i+1),
        category: cat,
        units,
        price,
        revenue: +(price*units).toFixed(2),
        stock: Math.floor(rand(0,400)),
        dos: Math.floor(rand(2,45)),
        competitor: +(price*rand(0.85,1.15)).toFixed(2)
      }
    });

    // ---------- Filters ----------
    const applyFilters = ()=>{
      const q = $('#searchInput').value.toLowerCase();
      const store = $('#storeSelect').value;
      // (Store is decorative in this mock; could filter per-store arrays)
      renderTopProducts(products.filter(p=>p.name.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q)));
      renderPricing();
      refreshKPIs();
      updateCharts();
    };
    $('#applyFilters').onclick = applyFilters;
    $('#searchInput').addEventListener('keydown', e=>{ if(e.key==='Enter') applyFilters(); });

    // ---------- KPIs ----------
    function refreshKPIs(){
      const rev = products.reduce((a,b)=>a+b.revenue,0);
      const units = products.reduce((a,b)=>a+b.units,0);
      const basket = rev / Math.max(units/3.2,1); // pseudo ratio
      $('#kpiRevenue').textContent = money(rev/120); // pretend "today"
      $('#kpiUnits').textContent = fmt.format(Math.floor(units/110));
      $('#kpiBasket').textContent = "$"+fmt2.format(basket);
      $('#kpiOOS').textContent = products.filter(p=>p.stock<12).length+" SKUs";
    }

    // ---------- Tables: Top Products ----------
    let topSort = 'revenue';
    function renderTopProducts(rows){
      const tbody = $('#topTable tbody'); tbody.innerHTML='';
      const sorted = rows.slice().sort((a,b)=> b[topSort]-a[topSort]).slice(0,12);
      for(const r of sorted){
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.sku}</td>
          <td>${r.name}</td>
          <td><span class="badge">${r.category}</span></td>
          <td>${fmt.format(r.units)}</td>
          <td>${money(r.price)}</td>
          <td><strong>${money(r.revenue)}</strong></td>
          <td><button class="btn ghost btn-sm" data-view="${r.sku}">View</button></td>
        `;
        tbody.appendChild(tr);
      }
      // row actions -> modal
      $$('button[data-view]').forEach(b=>b.onclick = ()=>openModal(b.dataset.view));
    }
    $('#sortRevenue').onclick=()=>{ topSort='revenue'; renderTopProducts(products); };
    $('#sortUnits').onclick=()=>{ topSort='units'; renderTopProducts(products); };
    $('#topSearch').oninput=()=> renderTopProducts(products.filter(p=> p.name.toLowerCase().includes($('#topSearch').value.toLowerCase())));

    // ---------- Competitor Pricing ----------
    function renderPricing(){
      const body = $('#priceTable tbody'); body.innerHTML='';
      const items = products.slice(0,10).map(p=>({
        name:p.name, ours:p.price, comp:p.competitor, delta:+(p.price - p.competitor).toFixed(2)
      })).sort((a,b)=>a.delta-b.delta);
      for(const it of items){
        const status = it.delta>0.01 ? `<span class="badge" style="border-color:var(--bad); color:var(--bad)">Undercut</span>` :
                        it.delta<-0.01 ? `<span class="badge" style="border-color:var(--good); color:var(--good)">Best</span>` :
                        `<span class="badge">Match</span>`;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${it.name}</td><td>${money(it.ours)}</td><td>${money(it.comp)}</td><td>${it.delta>0?'+':''}${money(it.delta)}</td><td>${status}</td>`;
        body.appendChild(tr);
      }
    }
    $('#matchAll').onclick = ()=>{ products.forEach(p=>p.price = p.competitor); applyFilters(); };
    $('#reprice10').onclick = ()=>{ products.forEach(p=>p.price = +(p.price*0.9).toFixed(2)); applyFilters(); };

    // ---------- Recommendations ----------
    function renderRecs(){
      const recs = [];
      // Promo: high stock, slow units
      for(const p of products.filter(p=>p.stock>250).slice(0,2)){
        recs.push({type:'Promo', text:`Run BOGO on <strong>${p.name}</strong>. High stock (${p.stock}) with below-trend units (${fmt.format(p.units)}). Expected +12% lift.`});
      }
      // Replenish: low stock, high units
      for(const p of products.filter(p=>p.stock<20 && p.units>1200).slice(0,2)){
        recs.push({type:'Replenish', text:`Reorder <strong>${p.name}</strong> now. Stock ${p.stock} < 20 with strong demand. Target DoS 21.`});
      }
      // Reprice: competitor undercut
      for(const p of products.filter(p=>p.price>p.competitor).slice(0,2)){
        recs.push({type:'Reprice', text:`Lower <strong>${p.name}</strong> to ${money(p.competitor)} (âˆ’${((p.price/p.competitor-1)*100).toFixed(1)}%) to match best market.`});
      }
      const box = $('#recs'); box.innerHTML='';
      for(const r of recs){
        const c = document.createElement('div');
        const color = r.type==='Promo'?'var(--accent)':r.type==='Replenish'?'var(--good)':'var(--warn)';
        c.className='card'; c.style.width='min(100%,360px)';
        c.innerHTML = `
          <div class="flex" style="justify-content:space-between; margin-bottom:6px">
            <div class="badge" style="border-color:${color}; color:${color}">${r.type}</div>
            <button class="btn ghost">Apply</button>
          </div>
          <div style="color:var(--muted)">${r.text}</div>
        `;
        box.appendChild(c);
      }
    }

    // ---------- Charts ----------
    const chartCfg = {
      plugins:{legend:{labels:{color:'var(--muted)'}}},
      scales:{x:{ticks:{color:'var(--muted)'}}, y:{ticks:{color:'var(--muted)'}}}
    };
    const weeks = Array.from({length:8},(_,i)=>`W${i+1}`);
    const revCtx = $('#revChart');
    const revChart = new Chart(revCtx,{type:'line', data:{
      labels:weeks,
      datasets:[{label:'Revenue', data:weeks.map(()=>Math.floor(rand(70,140))), tension:.35, fill:true,
        borderColor:'rgba(123,92,255,.9)', backgroundColor:'rgba(123,92,255,.18)'}]
    }, options:{...chartCfg, responsive:true, maintainAspectRatio:false}});
    $$('[data-series]').forEach(b=>{
      b.onclick=()=>{
        const t=b.dataset.series;
        const ds = revChart.data.datasets[0];
        if(t==='revenue'){ ds.label='Revenue'; ds.data=weeks.map(()=>Math.floor(rand(70,140))); }
        if(t==='units'){ ds.label='Units'; ds.data=weeks.map(()=>Math.floor(rand(40,180))); }
        if(t==='basket'){ ds.label='Basket'; ds.data=weeks.map(()=>+(rand(35,48).toFixed(2))); }
        revChart.update();
      }
    });

    const mixChart = new Chart($('#mixChart'),{
      type:'doughnut',
      data:{labels:['Grocery','Dairy','Produce','Beverage','Frozen'],
            datasets:[{data:[32,18,22,16,12],
              backgroundColor:['#7b5cff','#23c9b5','#ef6c6c','#f5a524','#4aa8ff']}]},
      options:{plugins:{legend:{position:'bottom', labels:{color:'var(--muted)'}}}}
    });
    function updateMixLabels(){
      $('#mixGro').textContent='32%';
      $('#mixDai').textContent='18%';
      $('#mixPro').textContent='22%';
    }

    const invChart = new Chart($('#invChart'),{
      type:'bar', data:{labels:['Grocery','Dairy','Produce','Bakery','Frozen'],
        datasets:[{label:'Days of Supply', data:[24,19,15,28,35]}]},
      options:{...chartCfg}
    });

    const cohortChart = new Chart($('#cohortChart'),{
      type:'line', data:{labels:['M0','M1','M2','M3','M4','M5'],
        datasets:[
          {label:'Jan Cohort', data:[100,68,55,47,41,36], tension:.35, fill:false, borderColor:'#7b5cff'},
          {label:'Feb Cohort', data:[100,71,58,50,45,39], tension:.35, fill:false, borderColor:'#23c9b5'}
        ]},
      options:{...chartCfg}
    });

    function updateCharts(){
      // could tie to filters; here we randomize slightly for interactivity
      revChart.data.datasets[0].data = revChart.data.datasets[0].data.map(v=>clamp(v + Math.floor(rand(-8,8)), 30, 180));
      revChart.update();
      invChart.data.datasets[0].data = invChart.data.datasets[0].data.map(v=>clamp(v + Math.floor(rand(-3,3)), 8, 45));
      invChart.update();
    }

    // ---------- Modal ----------
    function openModal(sku){
      const p = products.find(x=>x.sku===sku);
      if(!p) return;
      $('#modalTitle').textContent = `${p.name} â€¢ ${p.sku}`;
      $('#modalBody').innerHTML = `
        <div class="flex"><span class="badge">${p.category}</span><span class="badge">Stock: ${p.stock}</span><span class="badge">DoS: ${p.dos}</span></div>
        <p style="margin-top:10px">Price: <strong>${money(p.price)}</strong> â€¢ Units: <strong>${fmt.format(p.units)}</strong> â€¢ Revenue: <strong>${money(p.revenue)}</strong></p>
        <p>Competitor: <strong>${money(p.competitor)}</strong>. Suggest <em>${p.price>p.competitor?'match or beat':'hold price'}</em>.</p>
        <p style="color:var(--muted)">Elasticity est. âˆ’1.4, promo lift +10â€“16% expected. Shelf share 12% (Aisle 4).</p>
      `;
      $('#modal').classList.remove('hidden');
    }
    $('#closeModal').onclick = ()=>$('#modal').classList.add('hidden');
    $('#modal').addEventListener('click', e=>{ if(e.target.id==='modal') $('#modal').classList.add('hidden'); });

    // ---------- CSV Export (Top Products table) ----------
    function exportCSV(){
      const rows = [['SKU','Name','Category','Units','Price','Revenue']];
      $('#topTable tbody').querySelectorAll('tr').forEach(tr=>{
        const tds = tr.querySelectorAll('td');
        rows.push([tds[0].innerText, tds[1].innerText, tds[2].innerText.replace(/\n/g,' ').trim(), tds[3].innerText, tds[4].innerText, tds[5].innerText]);
      });
      const csv = rows.map(r=>r.map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'aurelo_top_products.csv';
      document.body.appendChild(a); a.click(); a.remove();
    }
    $('#exportCSV').onclick = exportCSV;

    // ---------- Init ----------
    (function init(){
      // set default dates (last 14 days)
      const today = new Date(); const d2 = new Date(today); d2.setDate(today.getDate()-13);
      $('#toDate').value = today.toISOString().slice(0,10);
      $('#fromDate').value = d2.toISOString().slice(0,10);
      $('#year').textContent = new Date().getFullYear();
      renderTopProducts(products);
      renderPricing();
      renderRecs();
      refreshKPIs();
      updateMixLabels();
    })();
  </script>
</body>
</html>
