<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aurelo Data ‚Ä¢ Store Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cpath fill='%238256ff' d='M128 16a112 112 0 1 0 0 224a112 112 0 0 0 0-224m0 32a80 80 0 1 1 0 160a80 80 0 0 1 0-160'/%3E%3Cpath fill='%23000' d='M80 128c0-26.51 21.49-48 48-48s48 21.49 48 48s-21.49 48-48 48s-48-21.49-48-48m24 0a24 24 0 1 0 48 0a24 24 0 0 0-48 0'/%3E%3C/svg%3E" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <style>
    :root {
      --bg: #0b0c10;
      --panel: #111218;
      --panel-2: #151725;
      --text: #e7e9ee;
      --muted: #a3a7b3;
      --brand: #8256ff;
      --brand-2: #4d2fff;
      --ok: #22c55e;
      --warn: #f59e0b;
      --err: #ef4444;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    :root[data-theme="light"] {
      --bg: #f6f7fb;
      --panel: #ffffff;
      --panel-2: #f2f4f8;
      --text: #0f172a;
      --muted: #475569;
      --brand: #6d28d9;
      --brand-2: #5b21b6;
      --shadow: 0 10px 25px rgba(2,6,23,.08);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      line-height: 1.35;
    }

    /* Layout */
    .app {
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 64px 1fr;
      grid-template-areas:
        "sidebar topbar"
        "sidebar main";
      height: 100vh;
      overflow: hidden;
    }
    .topbar {
      grid-area: topbar; display: flex; align-items: center; gap: 12px;
      background: var(--panel); padding: 0 16px; border-bottom: 1px solid rgba(148,163,184,.15);
      position: sticky; top: 0; z-index: 50;
    }
    .sidebar {
      grid-area: sidebar; background: var(--panel); border-right: 1px solid rgba(148,163,184,.15);
      display: flex; flex-direction: column; padding: 16px; gap: 12px;
    }
    .main {
      grid-area: main; overflow: auto; padding: 20px; background: var(--panel-2);
    }

    /* Sidebar */
    .brand {
      display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 12px;
      background: linear-gradient(145deg, rgba(130,86,255,.15), transparent);
    }
    .brand .logo {
      width: 34px; height: 34px; display: grid; place-items: center; border-radius: 10px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: var(--shadow);
      color: white; font-weight: 800; letter-spacing: .5px;
    }
    .search {
      display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 10px;
      background: var(--panel-2); border: 1px solid rgba(148,163,184,.15);
    }
    .search input { flex: 1; background: transparent; border: 0; outline: none; color: var(--text); font-size: 14px; }
    .side-section h5 { margin: 16px 8px 8px; color: var(--muted); font-weight: 600; text-transform: uppercase; letter-spacing: .08em; font-size: 11px; }
    .navlist { display: grid; gap: 6px; }
    .navitem { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 10px; cursor: pointer; color: var(--text);
      border: 1px solid transparent;
    }
    .navitem.active, .navitem:hover { background: var(--panel-2); border-color: rgba(148,163,184,.15); }
    .muted { color: var(--muted); }

    .footer { margin-top: auto; font-size: 12px; color: var(--muted); display:flex; gap:10px; align-items:center; }
    .chip { font-size: 11px; padding: 4px 8px; border-radius: 999px; background: rgba(130,86,255,.15); color: var(--brand); border: 1px solid rgba(130,86,255,.35); }

    /* Topbar */
    .topbar .btn { padding: 8px 12px; border-radius: 10px; border: 1px solid rgba(148,163,184,.2); background: var(--panel-2); color: var(--text); cursor: pointer; }
    .topbar .btn:hover { filter: brightness(1.05); }
    .spacer { flex: 1; }

    /* Cards & grids */
    .grid { display: grid; gap: 16px; }
    .grid.kpis { grid-template-columns: repeat(4, minmax(220px, 1fr)); }
    .grid.two { grid-template-columns: 1.2fr 1fr; }
    .grid.three { grid-template-columns: 1fr 1fr 1fr; }

    .card { background: var(--panel); border: 1px solid rgba(148,163,184,.15); border-radius: 16px; box-shadow: var(--shadow); }
    .card .head { display: flex; align-items: center; justify-content: space-between; padding: 14px 16px; border-bottom: 1px solid rgba(148,163,184,.12); }
    .card .body { padding: 16px; }
    .h1 { font-size: 28px; font-weight: 700; }
    .h2 { font-size: 22px; font-weight: 700; }
    .kpi { display: grid; gap: 8px; }
    .kpi .value { font-size: 26px; font-weight: 800; letter-spacing: -.02em; }
    .trend { font-size: 12px; font-weight: 600; }
    .up { color: var(--ok); }
    .down { color: var(--err); }

    /* Table */
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 10px 12px; border-bottom: 1px solid rgba(148,163,184,.12); text-align: left; }
    thead th { font-size: 12px; color: var(--muted); text-transform: uppercase; letter-spacing: .08em; }
    tbody tr:hover { background: rgba(148,163,184,.07); }
    .tag { padding: 4px 8px; border-radius: 999px; font-size: 11px; border: 1px solid rgba(148,163,184,.2); }

    /* Controls */
    .controls { display:flex; flex-wrap: wrap; gap: 8px; }
    .input, select { padding: 10px 12px; border-radius: 10px; border:1px solid rgba(148,163,184,.25); background: var(--panel); color: var(--text); }
    .btn-primary { background: linear-gradient(135deg, var(--brand), var(--brand-2)); color: white; border: 0; }

    .mini { font-size: 12px; color: var(--muted); }
    .right { text-align: right; }

    /* Responsive */
    @media (max-width: 1200px) { .grid.kpis { grid-template-columns: repeat(2, minmax(200px, 1fr)); } .grid.two { grid-template-columns: 1fr; } }
    @media (max-width: 900px) {
      .app { grid-template-columns: 1fr; grid-template-areas: "topbar" "main"; }
      .sidebar { position: fixed; inset: 64px auto 0 0; width: 280px; transform: translateX(-100%); transition: transform .25s ease; z-index: 60; }
      .sidebar.open { transform: translateX(0); }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">A</div>
        <div>
          <div style="font-weight:800; letter-spacing:.02em">Aurelo Data</div>
          <div class="mini">Store Intelligence Dashboard</div>
        </div>
      </div>

      <div class="search">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="muted"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        <input id="globalSearch" placeholder="Search products, SKUs, orders‚Ä¶" />
      </div>

      <div class="side-section">
        <h5>Navigation</h5>
        <div class="navlist" id="navlist">
          <div class="navitem active" data-target="#overview"><span>üè†</span> Overview</div>
          <div class="navitem" data-target="#sales"><span>üìà</span> Sales & Trends</div>
          <div class="navitem" data-target="#inventory"><span>üì¶</span> Inventory</div>
          <div class="navitem" data-target="#customers"><span>üë•</span> Customers</div>
          <div class="navitem" data-target="#pricing"><span>üí≤</span> Pricing & Competitors</div>
          <div class="navitem" data-target="#recommend"><span>‚ú®</span> Recommendations</div>
          <div class="navitem" data-target="#ops"><span>üõ†Ô∏è</span> Ops & Alerts</div>
          <div class="navitem" data-target="#exports"><span>üì§</span> Export</div>
        </div>
      </div>

      <div class="side-section">
        <h5>Filters</h5>
        <div class="grid" style="grid-template-columns:1fr 1fr">
          <select id="regionSelect">
            <option value="all">All Regions</option>
            <option>East</option>
            <option>West</option>
            <option>Central</option>
          </select>
          <select id="channelSelect">
            <option value="all">All Channels</option>
            <option>In‚ÄëStore</option>
            <option>Online</option>
            <option>Wholesale</option>
          </select>
          <input class="input" type="date" id="fromDate" />
          <input class="input" type="date" id="toDate" />
          <button class="btn btn-primary" id="applyFilters">Apply</button>
        </div>
      </div>

      <div class="footer">
        <span class="chip">v1.0</span>
        <span class="muted">¬© Aurelo Data</span>
      </div>
    </aside>

    <!-- TOPBAR -->
    <header class="topbar">
      <button class="btn" id="menuBtn">‚ò∞</button>
      <div class="h2">Dashboard</div>
      <div class="spacer"></div>
      <button class="btn" id="themeBtn">Toggle Theme</button>
      <button class="btn" id="refreshBtn">Refresh</button>
      <button class="btn btn-primary" id="newReportBtn">Generate Report</button>
    </header>

    <!-- MAIN -->
    <main class="main">
      <!-- OVERVIEW -->
      <section id="overview" class="view">
        <div class="grid kpis">
          <div class="card kpi">
            <div class="head"><div>Revenue (MTD)</div><div class="tag">All Stores</div></div>
            <div class="body">
              <div class="value" id="kpiRevenue">$1,204,560</div>
              <div class="trend up">‚ñ≤ +12.8% vs last month</div>
            </div>
          </div>
          <div class="card kpi">
            <div class="head"><div>Units Sold</div><div class="tag">MTD</div></div>
            <div class="body">
              <div class="value" id="kpiUnits">48,920</div>
              <div class="trend up">‚ñ≤ +5.3% WoW</div>
            </div>
          </div>
          <div class="card kpi">
            <div class="head"><div>Avg Order Value</div><div class="tag">Blended</div></div>
            <div class="body">
              <div class="value" id="kpiAOV">$43.12</div>
              <div class="trend down">‚ñº ‚àí1.2% WoW</div>
            </div>
          </div>
          <div class="card kpi">
            <div class="head"><div>Gross Margin</div><div class="tag">Normalized</div></div>
            <div class="body">
              <div class="value" id="kpiGM">38.6%</div>
              <div class="trend up">‚ñ≤ +0.7 pts</div>
            </div>
          </div>
        </div>

        <div class="grid two" style="margin-top:16px;">
          <div class="card">
            <div class="head"><div class="h2">Revenue Trend</div>
              <div class="controls">
                <select id="trendSpan">
                  <option>Last 30 days</option>
                  <option selected>Last 90 days</option>
                  <option>YTD</option>
                </select>
              </div></div>
            <div class="body"><canvas id="revTrend" height="110"></canvas></div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Sales by Category</div></div>
            <div class="body"><canvas id="catBar" height="110"></canvas></div>
          </div>
        </div>

        <div class="grid two" style="margin-top:16px;">
          <div class="card">
            <div class="head"><div class="h2">Top Products</div>
              <div class="controls">
                <input class="input" id="prodSearch" placeholder="Search products‚Ä¶"/>
                <button class="btn" id="exportTop">Export CSV</button>
              </div>
            </div>
            <div class="body">
              <table id="topProducts">
                <thead>
                  <tr>
                    <th data-sort="name">Product</th>
                    <th data-sort="sku">SKU</th>
                    <th class="right" data-sort="revenue">Revenue</th>
                    <th class="right" data-sort="units">Units</th>
                    <th class="right" data-sort="margin">Margin %</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Store Performance</div></div>
            <div class="body">
              <table id="storePerf">
                <thead>
                  <tr>
                    <th>Store</th>
                    <th>Region</th>
                    <th class="right">Revenue</th>
                    <th class="right">YoY</th>
                    <th class="right">NPS</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- SALES -->
      <section id="sales" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Channel Mix</div></div>
            <div class="body"><canvas id="channelPie" height="120"></canvas></div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Hourly Heatmap</div></div>
            <div class="body"><canvas id="heatmap" height="120"></canvas>
              <div class="mini">Tip: peak traffic 12‚Äì2pm local.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="inventory" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Low Stock Alerts</div><button class="btn" id="reorderBtn">Create Reorder PO</button></div>
            <div class="body">
              <table id="lowStock">
                <thead>
                  <tr>
                    <th>Product</th>
                    <th>SKU</th>
                    <th class="right">On Hand</th>
                    <th class="right">Days Cover</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">A/B Pricing Test</div></div>
            <div class="body"><canvas id="abLine" height="120"></canvas></div>
          </div>
        </div>
      </section>

      <!-- CUSTOMERS -->
      <section id="customers" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Customer Segments</div></div>
            <div class="body"><canvas id="segmentDonut" height="120"></canvas></div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Cohort Retention (90‚Äëday)</div></div>
            <div class="body">
              <table id="cohorts">
                <thead><tr><th>Cohort</th><th class="right">Week 1</th><th class="right">Week 4</th><th class="right">Week 8</th><th class="right">Week 12</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- PRICING -->
      <section id="pricing" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Competitor Pricing</div>
              <div class="controls"><button class="btn" id="syncCompetitors">Sync</button></div>
            </div>
            <div class="body">
              <table id="competitorPricing">
                <thead><tr><th>Product</th><th>Our Price</th><th>Competitor</th><th>Competitor Price</th><th class="right">Delta</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Elasticity Sandbox</div></div>
            <div class="body">
              <div class="controls" style="margin-bottom:10px">
                <label class="mini">Price ($): <input id="elasPrice" class="input" type="number" value="20" min="1" step="0.5" style="width:120px"></label>
                <label class="mini">Elasticity (E): <input id="elasE" class="input" type="number" value="-1.4" step="0.1" style="width:120px"></label>
                <button class="btn" id="runElas">Run</button>
              </div>
              <div id="elasResult" class="mini">Expected demand change: ‚Äî</div>
            </div>
          </div>
        </div>
      </section>

      <!-- RECOMMENDATIONS -->
      <section id="recommend" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Bundle Recommendations</div></div>
            <div class="body">
              <table id="bundles">
                <thead><tr><th>Bundle</th><th>Lift</th><th>Support</th><th class="right">Est. Uplift</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Promo Calendar</div></div>
            <div class="body">
              <table id="promos">
                <thead><tr><th>Date</th><th>Campaign</th><th>Channel</th><th class="right">Target Uplift</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- OPS & ALERTS -->
      <section id="ops" class="view" hidden>
        <div class="grid two">
          <div class="card">
            <div class="head"><div class="h2">Live Alerts</div></div>
            <div class="body">
              <table id="alerts">
                <thead><tr><th>Time</th><th>Type</th><th>Message</th><th>Status</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="card">
            <div class="head"><div class="h2">Ops Checklist</div></div>
            <div class="body">
              <ul id="checklist" style="margin:0; padding-left:18px; line-height:1.9">
                <li><label><input type="checkbox"/> Reconcile previous day sales</label></li>
                <li><label><input type="checkbox"/> Verify deposits & chargebacks</label></li>
                <li><label><input type="checkbox"/> Review low stock SKUs</label></li>
                <li><label><input type="checkbox"/> Update promo signage</label></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- EXPORTS -->
      <section id="exports" class="view" hidden>
        <div class="card">
          <div class="head"><div class="h2">Export Center</div></div>
          <div class="body">
            <div class="controls" style="margin-bottom:12px">
              <select id="exportWhat"><option value="topProducts">Top Products</option><option value="storePerf">Store Performance</option><option value="lowStock">Low Stock</option><option value="competitorPricing">Competitor Pricing</option></select>
              <button class="btn btn-primary" id="exportBtn">Export CSV</button>
            </div>
            <div class="mini">Exports are generated locally from current on‚Äëscreen data.</div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Simple Modal for Report / PO -->
  <dialog id="modal" style="border:0; border-radius:16px; padding:0; width:min(720px, 92vw); background: var(--panel); color: var(--text); box-shadow: var(--shadow);">
    <div class="card" style="margin:0; border:0; box-shadow:none">
      <div class="head"><div class="h2" id="modalTitle">Report</div><button class="btn" id="modalClose">Close</button></div>
      <div class="body" id="modalBody"></div>
    </div>
  </dialog>

  <script>
    // ---------- THEME ----------
    const root = document.documentElement;
    const themeBtn = document.getElementById('themeBtn');
    function setTheme(mode){ root.setAttribute('data-theme', mode); localStorage.setItem('aurelo-theme', mode); }
    setTheme(localStorage.getItem('aurelo-theme') || 'dark');
    themeBtn.addEventListener('click', ()=> setTheme(root.getAttribute('data-theme')==='dark'?'light':'dark'));

    // ---------- SIDEBAR TOGGLE ----------
    const sidebar = document.getElementById('sidebar');
    const menuBtn = document.getElementById('menuBtn');
    menuBtn.addEventListener('click', ()=> sidebar.classList.toggle('open'));

    // ---------- SIMPLE ROUTER ----------
    const navlist = document.getElementById('navlist');
    navlist.addEventListener('click', (e)=>{
      const item = e.target.closest('.navitem'); if(!item) return;
      document.querySelectorAll('.view').forEach(v=> v.hidden = true);
      document.querySelector(item.dataset.target).hidden = false;
      document.querySelectorAll('.navitem').forEach(n=> n.classList.remove('active'));
      item.classList.add('active');
      if (window.innerWidth < 900) sidebar.classList.remove('open');
    });

    // ---------- UTILITIES ----------
    const fmt = new Intl.NumberFormat(undefined, {maximumFractionDigits: 2});
    const money = v => new Intl.NumberFormat(undefined,{style:'currency',currency:'USD'}).format(v);

    function downloadCSV(filename, rows){
      const process = v => (v==null?'':String(v).replace(/"/g,'""'));
      const csv = rows.map(r => r.map(c=>`"${process(c)}"`).join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const link = Object.assign(document.createElement('a'), {href:url, download: filename});
      document.body.appendChild(link); link.click(); link.remove(); URL.revokeObjectURL(url);
    }

    function sortTable(tbody, idx, dir='asc', asNumber=false){
      const rows = Array.from(tbody.querySelectorAll('tr'));
      rows.sort((a,b)=>{
        const va = a.children[idx].dataset.sort ?? a.children[idx].textContent.trim();
        const vb = b.children[idx].dataset.sort ?? b.children[idx].textContent.trim();
        const na = asNumber ? parseFloat(va.replace(/[^0-9.-]/g,'')) : va.toLowerCase();
        const nb = asNumber ? parseFloat(vb.replace(/[^0-9.-]/g,'')) : vb.toLowerCase();
        return (na>nb?1:na<nb?-1:0)*(dir==='asc'?1:-1);
      });
      rows.forEach(r=> tbody.appendChild(r));
    }

    // ---------- DEMO DATA ----------
    const demo = {
      topProducts: [
        {name:'Aurelo Energy Drink ‚Äî Citrus 12oz', sku:'AE‚ÄëC12', revenue: 182340, units: 8120, margin: 0.41},
        {name:'Aurelo Protein Bar ‚Äî Cocoa 6pk', sku:'AP‚ÄëB06', revenue: 143220, units: 10112, margin: 0.36},
        {name:'Aurelo Sparkling Water ‚Äî Lime 8pk', sku:'AS‚ÄëL08', revenue: 122110, units: 9033, margin: 0.33},
        {name:'Aurelo Smart Bottle 24oz', sku:'AB‚Äë24', revenue: 117890, units: 2890, margin: 0.48},
        {name:'Aurelo Electrolyte Mix ‚Äî Berry 20ct', sku:'AM‚ÄëB20', revenue: 98310, units: 4520, margin: 0.39},
        {name:'Aurelo Creatine 300g', sku:'AC‚Äë300', revenue: 79230, units: 2100, margin: 0.45},
      ],
      stores: [
        {store:'Raleigh 01', region:'East', revenue: 264500, yoy:+8.4, nps:72},
        {store:'Charlotte 02', region:'East', revenue: 241200, yoy:+6.2, nps:69},
        {store:'Austin 07', region:'Central', revenue: 223400, yoy:+9.1, nps:75},
        {store:'San Jose 03', region:'West', revenue: 215600, yoy:+5.6, nps:71},
      ],
      lowStock: [
        {name:'Smart Bottle 24oz', sku:'AB‚Äë24', onhand: 28, days: 3, status:'Critical'},
        {name:'Protein Bar ‚Äî Cocoa 6pk', sku:'AP‚ÄëB06', onhand: 140, days: 5, status:'Low'},
        {name:'Electrolyte Mix ‚Äî Berry 20ct', sku:'AM‚ÄëB20', onhand: 80, days: 4, status:'Low'},
      ],
      competitorPricing: [
        {name:'Smart Bottle 24oz', ours: 29.99, comp:'HydraCo', compPrice: 31.49},
        {name:'Protein Bar ‚Äî Cocoa 6pk', ours: 9.99, comp:'Snacky', compPrice: 8.49},
        {name:'Energy Drink ‚Äî Citrus 12oz', ours: 2.49, comp:'VoltUp', compPrice: 2.79},
      ],
      bundles: [
        {bundle:'Energy Drink + Protein Bar', lift:1.22, support:0.18, uplift: 42000},
        {bundle:'Smart Bottle + Electrolyte Mix', lift:1.17, support:0.11, uplift: 23000},
      ],
      promos: [
        {date:'2025‚Äë10‚Äë01', campaign:'Fall Fuel Week', channel:'Omni', uplift:'+12%'}
      ],
      cohorts: [
        {c:'Jul‚Äë2025', w1:32, w4:21, w8:16, w12:12},
        {c:'Aug‚Äë2025', w1:34, w4:22, w8:17, w12:13},
        {c:'Sep‚Äë2025', w1:33, w4:23, w8:18, w12:‚Äî},
      ]
    };

    // ---------- POPULATE TABLES ----------
    function fillTopProducts(rows){
      const tb = document.querySelector('#topProducts tbody'); tb.innerHTML='';
      rows.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.name}</td>
          <td class="muted">${r.sku}</td>
          <td class="right" data-sort="${r.revenue}">${money(r.revenue)}</td>
          <td class="right" data-sort="${r.units}">${fmt.format(r.units)}</td>
          <td class="right" data-sort="${r.margin}">${(r.margin*100).toFixed(1)}%</td>`;
        tb.appendChild(tr);
      });
    }

    function fillStorePerf(){
      const tb = document.querySelector('#storePerf tbody'); tb.innerHTML='';
      demo.stores.forEach(s=>{
        const tr = document.createElement('tr');
        const yoyClass = s.yoy>=0? 'up' : 'down';
        tr.innerHTML = `
          <td>${s.store}</td>
          <td><span class="tag">${s.region}</span></td>
          <td class="right">${money(s.revenue)}</td>
          <td class="right ${yoyClass}">${s.yoy>0? '‚ñ≤':''}${s.yoy.toFixed(1)}%</td>
          <td class="right">${s.nps}</td>`;
        tb.appendChild(tr);
      });
    }

    function fillLowStock(){
      const tb = document.querySelector('#lowStock tbody'); tb.innerHTML='';
      demo.lowStock.forEach(s=>{
        const color = s.status==='Critical'? 'var(--err)' : 'var(--warn)';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.name}</td>
          <td class="muted">${s.sku}</td>
          <td class="right">${s.onhand}</td>
          <td class="right">${s.days}</td>
          <td><span class="tag" style="color:${color}; border-color:${color}33">${s.status}</span></td>`;
        tb.appendChild(tr);
      });
    }

    function fillCompetitor(){
      const tb = document.querySelector('#competitorPricing tbody'); tb.innerHTML='';
      demo.competitorPricing.forEach(r=>{
        const delta = r.ours - r.compPrice;
        const cls = delta<=0? 'up':'down';
        const sign = delta>0? '+':'';
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${r.name}</td>
          <td>${money(r.ours)}</td>
          <td class="muted">${r.comp}</td>
          <td>${money(r.compPrice)}</td>
          <td class="right ${cls}">${sign}${delta.toFixed(2)}</td>`;
        tb.appendChild(tr);
      });
    }

    function fillBundles(){
      const tb = document.querySelector('#bundles tbody'); tb.innerHTML='';
      demo.bundles.forEach(b=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${b.bundle}</td><td>${b.lift.toFixed(2)}√ó</td><td>${(b.support*100).toFixed(1)}%</td><td class="right">${money(b.uplift)}</td>`;
        tb.appendChild(tr);
      });
    }

    function fillPromos(){
      const tb = document.querySelector('#promos tbody'); tb.innerHTML='';
      demo.promos.forEach(p=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.date}</td><td>${p.campaign}</td><td>${p.channel}</td><td class="right up">${p.uplift}</td>`;
        tb.appendChild(tr);
      });
    }

    function fillCohorts(){
      const tb = document.querySelector('#cohorts tbody'); tb.innerHTML='';
      demo.cohorts.forEach(c=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${c.c}</td><td class="right">${c.w1}%</td><td class="right">${c.w4}%</td><td class="right">${c.w8}%</td><td class="right">${c.w12 ?? '‚Äî'}%</td>`;
        tb.appendChild(tr);
      });
    }

    // ---------- CHARTS ----------
    let revChart, catChart, channelChart, heatChart, abChart, segChart;

    function makeCharts(){
      const ctx1 = document.getElementById('revTrend');
      const labels = Array.from({length: 13}, (_,i)=>`W${i+1}`);
      const data1 = [42,45,48,40,52,55,58,62,61,66,70,74,78];
      revChart?.destroy();
      revChart = new Chart(ctx1,{ type:'line', data:{ labels, datasets:[{ label:'Revenue', data:data1, tension:.35, fill:true, borderColor:getComputedStyle(root).getPropertyValue('--brand').trim(), backgroundColor:getComputedStyle(root).getPropertyValue('--brand').trim()+"26" }]}, options:{ plugins:{legend:{display:false}}, scales:{ y:{ grid:{ color:'rgba(148,163,184,.15)'}}, x:{ grid:{ display:false}}}}});

      const ctx2 = document.getElementById('catBar');
      catChart?.destroy();
      catChart = new Chart(ctx2,{ type:'bar', data:{ labels:['Beverage','Snacks','Accessories','Supplements'], datasets:[{ label:'Sales', data:[520,430,280,390]}]}, options:{ plugins:{legend:{display:false}}, scales:{ y:{ grid:{ color:'rgba(148,163,184,.15)'}}, x:{ grid:{ display:false}}}}});

      const ctx3 = document.getElementById('channelPie');
      channelChart?.destroy();
      channelChart = new Chart(ctx3,{ type:'doughnut', data:{ labels:['In‚ÄëStore','Online','Wholesale'], datasets:[{ data:[58,34,8]}]}, options:{ plugins:{legend:{position:'bottom'}}});

      const ctx4 = document.getElementById('heatmap');
      heatChart?.destroy();
      // Fake heatmap: use stacked bars to mimic intensity
      const hours = ['9a','10a','11a','12p','1p','2p','3p','4p','5p'];
      const base = [10,12,18,26,28,24,20,18,14];
      heatChart = new Chart(ctx4,{ type:'bar', data:{ labels: hours, datasets:[{label:'Traffic', data: base}]}, options:{ plugins:{legend:{display:false}}, scales:{ y:{ display:false, grid:{display:false}}, x:{ grid:{display:false}}}}});

      const ctx5 = document.getElementById('abLine');
      abChart?.destroy();
      abChart = new Chart(ctx5,{ type:'line', data:{ labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], datasets:[{label:'Price A', data:[100,104,99,110,120,140,138]}, {label:'Price B', data:[98,96,101,105,112,125,130]}]}, options:{ plugins:{legend:{position:'bottom'}}, scales:{ y:{ grid:{ color:'rgba(148,163,184,.15)'}}, x:{ grid:{ display:false}}}}});

      const ctx6 = document.getElementById('segmentDonut');
      segChart?.destroy();
      segChart = new Chart(ctx6,{ type:'doughnut', data:{ labels:['Loyal','Occasional','New'], datasets:[{ data:[44,38,18]}]}, options:{ plugins:{legend:{position:'bottom'}}});
    }

    // ---------- FILTERS ----------
    document.getElementById('applyFilters').addEventListener('click', ()=>{
      const region = document.getElementById('regionSelect').value;
      const channel = document.getElementById('channelSelect').value;
      const from = document.getElementById('fromDate').value;
      const to = document.getElementById('toDate').value;
      // In a real app, fetch with these filters. Here we just show a modal.
      showModal('Filters Applied', `<div class="mini">Region: <b>${region}</b> ‚Äî Channel: <b>${channel}</b> ‚Äî Range: <b>${from||'‚Äî'} to ${to||'‚Äî'}</b></div>`);
    });

    // ---------- SEARCH (Top Products) ----------
    const prodSearch = document.getElementById('prodSearch');
    prodSearch.addEventListener('input', ()=>{
      const q = prodSearch.value.toLowerCase();
      const filtered = demo.topProducts.filter(p => p.name.toLowerCase().includes(q) || p.sku.toLowerCase().includes(q));
      fillTopProducts(filtered);
    });

    // Global quick filter for all tables (client‚Äëside demo)
    document.getElementById('globalSearch').addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase();
      document.querySelectorAll('tbody').forEach(tb =>{
        tb.querySelectorAll('tr').forEach(tr =>{
          const show = tr.textContent.toLowerCase().includes(q);
          tr.style.display = show? '' : 'none';
        });
      });
    });

    // ---------- EXPORTS ----------
    function toRowsFromTable(tableId){
      const table = document.getElementById(tableId);
      const headers = Array.from(table.querySelectorAll('thead th')).map(th=>th.textContent.trim());
      const rows = Array.from(table.querySelectorAll('tbody tr')).map(tr=> Array.from(tr.children).map(td=> td.textContent.trim()));
      return [headers, ...rows];
    }

    document.getElementById('exportTop').addEventListener('click', ()=>{
      downloadCSV('top_products.csv', toRowsFromTable('topProducts'));
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const what = document.getElementById('exportWhat').value;
      downloadCSV(`${what}.csv`, toRowsFromTable(what));
    });

    // ---------- ELASTICITY ----------
    document.getElementById('runElas').addEventListener('click', ()=>{
      const p = parseFloat(document.getElementById('elasPrice').value);
      const E = parseFloat(document.getElementById('elasE').value);
      const pct = E * (1); // 1 dollar change baseline demo
      document.getElementById('elasResult').textContent = `Expected demand change for $1 price change at $${p.toFixed(2)} with E=${E.toFixed(1)} ‚Üí ${pct.toFixed(1)}%`;
    });

    // ---------- COMPETITOR SYNC ----------
    document.getElementById('syncCompetitors').addEventListener('click', ()=>{
      showModal('Competitor Sync', '<div class="mini">Queued competitor price refresh. Expected in ~30s (demo).</div>');
    });

    // ---------- REORDER PO ----------
    document.getElementById('reorderBtn').addEventListener('click', ()=>{
      const items = demo.lowStock.map(s=>`<tr><td>${s.name}</td><td>${s.sku}</td><td class=right>${s.onhand}</td></tr>`).join('');
      showModal('Reorder Purchase Order', `<table><thead><tr><th>Product</th><th>SKU</th><th class=right>On Hand</th></tr></thead><tbody>${items}</tbody></table>
        <div class=controls style='margin-top:10px'><button class='btn btn-primary' onclick='alert("PO submitted (demo)")'>Submit PO</button></div>`);
    });

    // ---------- TABLE SORTING ----------
    document.querySelectorAll('#topProducts thead th').forEach((th, idx)=>{
      th.style.cursor = 'pointer';
      th.addEventListener('click', ()=> sortTable(document.querySelector('#topProducts tbody'), idx, 'desc', idx>=2));
    });

    // ---------- MODAL ----------
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');
    function showModal(title, html){ modalTitle.textContent = title; modalBody.innerHTML = html; modal.showModal(); }
    modalClose.addEventListener('click', ()=> modal.close());

    // ---------- REFRESH (Demo) ----------
    document.getElementById('refreshBtn').addEventListener('click', ()=>{
      // Shuffle a KPI for fun
      const delta = (Math.random()*4 - 2).toFixed(1);
      document.getElementById('kpiAOV').textContent = `$${(42 + (Math.random()*2)).toFixed(2)}`;
      document.getElementById('kpiGM').textContent = `${(38.6 + (Math.random()*1-0.5)).toFixed(1)}%`;
      const trend = document.querySelector('#overview .kpi:nth-child(3) .trend');
      trend.className = 'trend ' + (delta>=0?'up':'down');
      trend.textContent = (delta>=0?'‚ñ≤ ':'‚ñº ') + `${delta}% WoW`;
      makeCharts();
    });

    // ---------- INIT ----------
    function init(){
      // default dates: last 30 days
      const today = new Date();
      const from = new Date(today); from.setDate(today.getDate()-30);
      document.getElementById('toDate').value = today.toISOString().slice(0,10);
      document.getElementById('fromDate').value = from.toISOString().slice(0,10);

      fillTopProducts(demo.topProducts);
      fillStorePerf();
      fillLowStock();
      fillCompetitor();
      fillBundles();
      fillPromos();
      fillCohorts();
      makeCharts();
    }

    init();
  </script>
</body>
</html>
